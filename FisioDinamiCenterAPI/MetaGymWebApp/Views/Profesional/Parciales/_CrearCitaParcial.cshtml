@model RegistroCitaModelo
@{
    Layout = null;
}

<div class="bg-dark text-white p-3 rounded">
    <h4 class="mb-3">Nueva Cita</h4>

    <form asp-action="CrearCitaParcial" method="post">

        <!-- Cliente -->
        <div class="mb-3">
            <label class="form-label">Cliente</label>
            <input type="hidden" asp-for="Cita.ClienteId" id="clienteIdParcial" />
            <input type="text" id="clienteNombreParcial" class="form-control mb-2" placeholder="Cliente seleccionado" readonly />

            <input type="text" id="buscadorClienteParcial" class="form-control mb-2" placeholder="Buscar cliente..." />

            <table id="tablaClientesParcial" class="table table-dark table-sm table-bordered">
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>CI</th>
                        <th>Acción</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var cliente in Model.Clientes)
                    {
                        <tr>
                            <td>@cliente.NombreCompleto</td>
                            <td>@cliente.Ci</td>
                            <td>
                                <button type="button"
                                        class="btn btn-sm btn-success seleccionar-cliente-parcial"
                                        data-id="@cliente.Id"
                                        data-nombre="@cliente.NombreCompleto">
                                    ✔
                                </button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
            <span asp-validation-for="Cita.ClienteId" class="text-danger"></span>
        </div>

        <!-- Especialidad -->
        <div class="mb-3">
            <label asp-for="Cita.EspecialidadId" class="form-label">Especialidad</label>
            <select asp-for="Cita.EspecialidadId" class="form-select" id="selectEspecialidadParcial">
                <option value="">Seleccione una especialidad</option>
                @foreach (var esp in Model.Especialidades)
                {
                    <option value="@esp.Id">@esp.NombreEspecialidad</option>
                }
            </select>
        </div>

        <!-- Tipo de atención -->
        <div class="mb-3">
            <label asp-for="Cita.TipoAtencionId" class="form-label">Tipo de Atención</label>
            <select asp-for="Cita.TipoAtencionId" class="form-select" id="selectTipoAtencionParcial">
                <option value="">Seleccione un tipo</option>
            </select>
            <div id="descripcionTipoParcial" class="text-light mt-1 fst-italic"></div>
        </div>

        <!-- Establecimiento -->
        <div class="mb-3">
            <label asp-for="Cita.EstablecimientoId" class="form-label">Establecimiento</label>
            <select asp-for="Cita.EstablecimientoId" class="form-select">
                <option value="">Seleccione un establecimiento</option>
                @foreach (var est in Model.Establecimientos)
                {
                    <option value="@est.Id">@est.Nombre</option>
                }
            </select>
        </div>

        <!-- Fecha -->
        <div class="mb-3">
            <label asp-for="Cita.FechaAsistencia" class="form-label">Fecha y Hora</label>
            <input asp-for="Cita.FechaAsistencia" type="datetime-local" class="form-control"
                   value="@Model.Cita.FechaAsistencia.ToString("yyyy-MM-ddTHH:mm")" />
        </div>

        <!-- Descripción -->
        <div class="mb-3">
            <label asp-for="Cita.Descripcion" class="form-label">Descripción</label>
            <textarea asp-for="Cita.Descripcion" class="form-control" rows="2"></textarea>
        </div>

        <button type="submit" class="btn btn-success btn-sm">Guardar</button>
        <button type="button" class="btn btn-outline-light btn-sm" onclick="cerrarPanelDerecho()">Cancelar</button>
    </form>
</div>

<script>
    const especialidades = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Especialidades));
</script>