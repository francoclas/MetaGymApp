
@model List<SesionEntrenadaDTO>

@{
    ViewData["Title"] = "Historial de Entrenamientos";
    var ultimaSesion = ViewBag.UltimaSesion as SesionEntrenadaDTO;
    var promedioDuracion = (double)ViewBag.PromedioDuracion;
}

<link rel="stylesheet" href="~/css/cliente/sesionesEntrenamientoHistorial.css" />
<script src="~/js/cliente/busquedaHistorialSesiones.js"></script>

<div class="container mt-4">
    @if (!Model.Any())
    {
        <div class="text-center bg-dark p-4 rounded shadow-sm mb-5">
            <h4 class="text-warning">Todavía no tenés registrada ninguna sesión de entrenamiento</h4>
            <p class="mt-3">Podés registrar y hacer seguimiento de tus entrenamientos desde la aplicación de MetaGym.</p>
            <p class="text-muted small">Descargala desde aquí:</p>
            <a href="https://www.instagram.com/metagym.uy/" class="btn btn-outline-light mt-2" target="_blank">
                Enlace Aplicación
            </a>
        </div>
    }
    else
    {
        <h2 class="text-white">Historial de entrenamientos</h2>
        @if (ultimaSesion != null)
        {
            <p class="text-secondary">Último entrenamiento: @ultimaSesion.FechaRealizada.ToString("dd/MM/yyyy")</p>
        }
        <p class="text-light">Promedio de duración: @Math.Round(promedioDuracion) minutos</p>

        <hr class="text-white" />

        <div class="busqueda-filtros mb-4">
            <label class="text-white">Buscar por nombre de rutina:</label>
            <input type="text" id="buscadorRutina" class="form-control" placeholder="Ej: Piernas, Fullbody..." />

            <div class="row mt-3">
                <div class="col-md-6">
                    <label class="text-white">Desde:</label>
                    <input type="date" id="fechaDesde" class="form-control" />
                </div>
                <div class="col-md-6">
                    <label class="text-white">Hasta:</label>
                    <input type="date" id="fechaHasta" class="form-control" />
                </div>
            </div>
        </div>

        <div id="contenedorSesiones" class="lista-sesiones">
            @foreach (var sesion in Model)
            {
                <div class="card-sesion"
                     data-nombre="@sesion.NombreRutina"
                     data-fecha="@sesion.FechaRealizada.ToString("yyyy-MM-dd")">
                    <h4>@sesion.NombreRutina</h4>
                    <p class="text-muted">
                        Fecha: @sesion.FechaRealizada.ToString("dd/MM/yyyy") |
                        Duración: @(sesion.DuracionMin.HasValue ? sesion.DuracionMin + " min" : "No registrada")
                    </p>
                    <a href="@Url.Action("SesionEntrenada", "Cliente", new { id = sesion.SesionRutinaId })"
                       class="btn btn-sm btn-outline-danger">
                        Ver detalles
                    </a>
                </div>
            }
        </div>
    }
</div>
